import requests

def set_branch_protection(repo_owner, repo_name, branch, token):
    url = f"https://api.github.com/repos/{repo_owner}/{repo_name}/branches/{branch}/protection"

    headers = {
        "Authorization": f"token {token}",
        "Accept": "application/vnd.github.luke-cage-preview+json"
    }

    payload = {
        "required_status_checks": None,
        "enforce_admins": True,
        "required_pull_request_reviews": {
            "dismiss_stale_reviews": False,
            "require_code_owner_reviews": True,  # Enforce CODEOWNERS approvals
            "required_approving_review_count": 2  # Set required approvers count
        },
        "restrictions": None,
        "allow_force_pushes": False,
        "allow_deletions": False
    }

    response = requests.put(url, headers=headers, json=payload)

    if response.status_code == 200:
        print(f"Branch protection rule successfully applied for {branch} branch.")
    else:
        print(f"Error: {response.status_code} - {response.text}")

# Set your repository details and token here
repo_owner = "your-github-username"
repo_name = "your-repository-name"
branch = "main"
token = "your-personal-access-token"

set_branch_protection(repo_owner, repo_name, branch, token)
